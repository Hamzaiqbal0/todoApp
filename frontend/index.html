<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .todo-item {
            transition: all 0.3s ease;
        }
        .completed {
            opacity: 0.7;
        }
        .completed .todo-title {
            text-decoration: line-through;
        }
        .priority-high { color: #e53e3e; }
        .priority-medium { color: #d69e2e; }
        .priority-low { color: #38a169; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-2">Todo Application</h1>
            <p class="text-blue-100">Manage your tasks efficiently</p>
        </header>

        <main>
            <!-- Add Todo Form -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8 card">
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="new-todo-input"
                        placeholder="What needs to be done?" 
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        onkeypress="handleKeyPress(event)"
                    />
                    <button 
                        onclick="addTodo()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition duration-200"
                    >
                        <i class="fas fa-plus"></i>
                        <span>Add</span>
                    </button>
                </div>
            </div>

            <!-- Todo List -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden card">
                <div class="border-b border-gray-200 p-4 bg-gray-50">
                    <h2 class="text-xl font-semibold text-gray-800">Your Tasks</h2>
                </div>

                <div id="todo-list" class="divide-y divide-gray-200">
                    <div class="p-8 text-center text-gray-500" id="loading-message">
                        Loading todos...
                    </div>
                </div>
            </div>
        </main>

        <footer class="mt-12 text-center text-blue-100 text-sm">
            <p>Â© 2026 Todo Application. All rights reserved.</p>
        </footer>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        // Load todos when page loads
        document.addEventListener('DOMContentLoaded', loadTodos);
        
        async function loadTodos() {
            try {
                const response = await fetch(`${API_BASE_URL}/todos`);
                const data = await response.json();
                
                if (data.success) {
                    displayTodos(data.data.todos || []);
                } else {
                    console.error('Failed to load todos:', data.error);
                    document.getElementById('todo-list').innerHTML = '<div class="p-8 text-center text-red-500">Failed to load todos</div>';
                }
            } catch (error) {
                console.error('Error loading todos:', error);
                document.getElementById('todo-list').innerHTML = '<div class="p-8 text-center text-red-500">Error connecting to server</div>';
            }
        }
        
        function displayTodos(todos) {
            const todoListElement = document.getElementById('todo-list');
            
            if (todos.length === 0) {
                todoListElement.innerHTML = '<div class="p-8 text-center text-gray-500">No tasks yet. Add your first task!</div>';
                return;
            }
            
            todoListElement.innerHTML = '';
            
            todos.forEach(todo => {
                const todoElement = document.createElement('div');
                todoElement.className = `p-4 todo-item ${todo.completed ? 'completed bg-gray-50' : ''}`;
                todoElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <button 
                                onclick="toggleTodo('${todo.id}', ${todo.completed})"
                                class="w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                                    todo.completed 
                                        ? 'bg-green-500 border-green-500 text-white' 
                                        : 'border-gray-300 hover:border-green-400'
                                }"
                            >
                                ${todo.completed ? '<i class="fas fa-check text-xs"></i>' : ''}
                            </button>
                            
                            <div>
                                <h3 class="todo-title font-medium ${
                                    todo.completed ? 'text-gray-500' : 'text-gray-800'
                                }">
                                    ${todo.title}
                                </h3>
                                ${todo.description ? `<p class="text-sm text-gray-600 mt-1">${todo.description}</p>` : ''}
                                
                                <div class="flex gap-3 mt-2">
                                    ${todo.priority ? `
                                        <span class="priority-${todo.priority} text-xs px-2 py-1 rounded-full bg-opacity-20">
                                            ${todo.priority}
                                        </span>
                                    ` : ''}
                                    
                                    ${todo.category ? `
                                        <span class="text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800">
                                            ${todo.category}
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button 
                                onclick="deleteTodo('${todo.id}')"
                                class="p-2 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-full"
                            >
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${todo.due_date ? `
                        <div class="mt-2 text-sm text-gray-500 flex items-center gap-1">
                            <i class="far fa-calendar"></i>
                            Due: ${new Date(todo.due_date).toLocaleDateString()}
                        </div>
                    ` : ''}
                `;
                
                todoListElement.appendChild(todoElement);
            });
        }
        
        async function addTodo() {
            const inputElement = document.getElementById('new-todo-input');
            const title = inputElement.value.trim();
            
            if (!title) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/todos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        priority: 'medium'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    inputElement.value = '';
                    loadTodos(); // Reload todos
                } else {
                    alert('Failed to add todo: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error adding todo:', error);
                alert('Error adding todo');
            }
        }
        
        async function toggleTodo(id, isCompleted) {
            try {
                const response = await fetch(`${API_BASE_URL}/todos/${id}/toggle`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    loadTodos(); // Reload todos
                } else {
                    alert('Failed to update todo: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error toggling todo:', error);
                alert('Error updating todo');
            }
        }
        
        async function deleteTodo(id) {
            if (!confirm('Are you sure you want to delete this todo?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/todos/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    loadTodos(); // Reload todos
                } else {
                    alert('Failed to delete todo: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting todo:', error);
                alert('Error deleting todo');
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                addTodo();
            }
        }
    </script>
</body>
</html>